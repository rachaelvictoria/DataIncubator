{
    "contents" : "#Goal - look at the number of STEM bachelor degrees granted by race for all of \n#bachelor's granting institutions in the US over a four year period (2009 - 2013)\n#Compare this to the demographic makeup of all of the 12th graders summarized \n#the same time frame. \n\n\n#################Get school data######################################\n#Background information: Data was taken from IPEDS Completions Survey by Race/Sum of Degrees/Awards Conferred by Race\n# Classification variables:\n#         -Year\n# Filter for following values: 5 most recent years\n# \n# -Academic Institution (standardized)\n# Filter for following values: Brown University; California Institute of Technology; Carnegie Mellon University; Case Western Reserve University; Clarkson University; Clemson University; Colorado School of Mines; Cornell University, All Campuses; Drexel University; Georgia Institute of Technology, Main Campus; Illinois Institute of Technology; Iowa State University; Johns Hopkins University; Lehigh University; Massachusetts Institute of Technology; Michigan Technological University; North Carolina State University at Raleigh; Pennsylvania State U, Main Campus; Princeton University; Purdue University, Main Campus; Rensselaer Polytechnic Institute; Rice University; SUNY College of Environmental Sci & Forestry; Stanford University; Stevens Institute of Technology; Texas A&M University Main Campus; University of California-Berkeley; University of California-Davis; University of California-Irvine; University of California-Los Angeles; University of California-San Diego; University of Illinois at Urbana-Champaign; University of Michigan at Ann Arbor; University of Missouri, Rolla; University of Rochester; University of Tulsa; Virginia Polytechnic Institute and State Univ; Worcester Polytechnic Institute\n# \n# -Highest Degree (standardized)\n# Filter for following values: Doctorate-granting Institutions\n# \n# -Gender\n# Filter for following values: All values\n# \n# -Race & Ethnicity (standardized)\n# Filter for following values: Black, Non-Hispanic; American Indian or Alaska Native; Hispanic; Other/Unknown Races & Ethnicities\n# \n# -Academic Discipline, Detailed (standardized)\n# Filter for following values: Aerospace Engineering; Chemical Engineering; Civil Engineering; Electrical Engineering; Mechanical Engineering; Materials Engineering; Industrial Engineering; Other Engineering; Astronomy; Chemistry; Physics; Other Physical Sciences; Atmospheric Sciences; Mathematics and Statistics; Computer Science; Biological Sciences\n# \n# -Level of Degree or Other Award\n# Filter for following values: Doctorate Degrees; Doctorate Degree-Research/Scholarship; Doctorate Degree-Professional Practice; Doctorate Degree-Other; Master's Degrees\n# \n# \n# Table was created by the WebCaspar website (https://ncsesdata.nsf.gov/webcaspar/) on Wed, 8 Apr 2015 16:47 -0400\n\nraw_data <- read.csv(\"Degree_Data_By_Race.csv\", header = TRUE, stringsAsFactors = FALSE)\n#Original Column Headers\n# [1] \"Year\"                                                                  \n# [2] \"Academic.Institution..standardized.\"                                   \n# [3] \"FICE\"                                                                  \n# [4] \"City.location.of.institution\"                                          \n# [5] \"State\"                                                                 \n# [6] \"Gender\"                                                                \n# [7] \"Race...Ethnicity..standardized.\"                                       \n# [8] \"Academic.Discipline..Broad..standardized.\"                             \n# [9] \"Level.of.Degree.or.Other.Award\"                                        \n# [10] \"Degrees.Awards.Conferred.by.Race..NSF.population.of.institutions..Sum.\"\ncolnames(raw_data) <- c(\"year\", \"school\", \"FICE\", \"city\",\"state\",  \"gender\", \"race\", \"major_area\", \"degree\", \"num_deg_by_race\", \"zip\")\nfirst_set <- raw_data[,1:9]\nnum_deg_by_race <- c(as.numeric(raw_data[, 10]))\nzip <- as.character(raw_data[,11])\nraw_data_numeric <- data.frame(first_set, num_deg_by_race, zip)\n\n#Aggregate over the five year period\nraw_data_year_agg <- aggregate(num_deg_by_race ~ school + city + state + race + major_area + degree + zip, raw_data_numeric, sum)\n\n#subset the data to only bachelor degrees\nbach_data <- raw_data_year_agg[which(raw_data_year_agg$degree == \"Bachelor's Degrees\"),]\n#subset data by race\nbach_data_black <- bach_data[which(bach_data$race == \"Black, Non-Hispanic\"),]\nbach_data_native <- bach_data[which(bach_data$race == \"American Indian or Alaska Native\"),]\nbach_data_asianPI <- bach_data[which(bach_data$race == \"Asian or Pacific Islander\"),]\nbach_data_hispanic <- bach_data[which(bach_data$race == \"Hispanic\"),]\nbach_data_white <- bach_data[which(bach_data$race == \"White, Non-Hispanic\"),]\n\n#Calculate the total number of STEM bachelor degrees given over a five year period\nNum_deg <- aggregate(num_deg_by_race ~ school + city + state + zip, bach_data, sum)\ncolnames(Num_deg) <- c(\"school\", \"city\", \"state\",\"zip\",  \"total STEM degrees\")\n#Calculate the total number of STEM bachelor degrees given over a five year period by race\nNum_deg_black <- aggregate(num_deg_by_race ~ school + city + state + zip, bach_data_black, sum)\ncolnames(Num_deg_black) <- c(\"school\", \"city\", \"state\",\"zip\", \"total degrees Black\")\nNum_deg_native <- aggregate(num_deg_by_race ~ school + city + state + zip, bach_data_native, sum)\ncolnames(Num_deg_native) <- c(\"school\", \"city\", \"state\",\"zip\", \"total degrees Native\")\nNum_deg_asianPI <- aggregate(num_deg_by_race ~ school + city + state + zip, bach_data_asianPI, sum)\ncolnames(Num_deg_asianPI) <- c(\"school\", \"city\", \"state\",\"zip\", \"total degrees AsianPI\")\nNum_deg_hispanic <- aggregate(num_deg_by_race ~ school + city + state + zip, bach_data_hispanic, sum)\ncolnames(Num_deg_hispanic) <- c(\"school\", \"city\", \"state\",\"zip\", \"total degrees Hispanic\")\nNum_deg_white <- aggregate(num_deg_by_race ~ school + city + state + zip, bach_data_white, sum)\ncolnames(Num_deg_white) <- c(\"school\", \"city\", \"state\",\"zip\", \"total degrees White\")\n\n\n#create a single table with the total number of STEM bachelor degrees and the total by race\ntotal <- merge(Num_deg, Num_deg_black)\ntotal <- merge(total, Num_deg_native)\ntotal <- merge(total, Num_deg_asianPI)\ntotal <- merge(total, Num_deg_hispanic)\ntotal <- merge(total, Num_deg_white)\n\n#list all previous variables \nto_remove <- ls()\n#Reorder list by total number of STEM degrees granted, descending\nDegree_School_Table <- total[order(-total[,5]),]\n\n#Do a bit of cleanup\nrm(list=to_remove)\n\n##########################################################################################################\n# Note at this point that the University of Phoenix is the top STEM undergrad                            #\n# degree granting institution in the US. As University of Phoenix has made a business of                 #                \n# offering online degrees cannot get demographic data on the area surrounding this particular school.    #\n# Will therefore eliminate this value and use top values 2-11                                            #\n##########################################################################################################\n\n\n########################Get table of zip codes and counties/state#########################################\n#Going to use a table of zip codes to correlate school zip code with county. \n#Can then use county demographics from US census\n\n\n#Going to need to convert state abbreviations found in the zip code table to \n#state names,Getting the state abbreviations in the zip code table to state names, found a table online\nfileUrl_states <- \"http://www.fonz.net/blog/wp-content/uploads/2008/04/states.csv\"\ndownload.file(fileUrl_states, destfile = \"./states.csv\")\nus_states <- read.csv(\"states.csv\", header = TRUE)\ncolnames(us_states)<- c(\"full\", \"state\")\n\n\n#First use US postal service database of zipcodes\n#downloaded from http://www.unitedstateszipcodes.org/zip-code-database/ on 4/12/15\n\nfileUrl <- \"http://www.unitedstateszipcodes.org/zip_code_database.csv\"\ndownload.file(fileUrl, destfile = \"./zip_code_database.csv\")\nzip_codes_table <- read.csv(\"zip_code_database.csv\", header = TRUE)\nzips <- zip_codes_table$zip\nzips <- formatC(zips, width = 5, flag = \"0\")\nzips_table <- data.frame(zips, zip_codes_table$state, zip_codes_table$county)\ncolnames(zips_table)<- c(\"zip\", \"state\", \"county\")\n\nzips_table <- zips_table[order(zips_table$state),]\n#Select the subset of state names that exist in the US, eliminate Military and \n#sort alphabetically\nlist_states <- us_states[,2]\nzips_table <- with(zips_table, zips_table[state %in% list_states,])\ncolnames(zips_table) <- c(\"zip\", \"state\", \"county\")\ncounty_zips <- gsub(x = zips_table$county, pattern = \" County\", replace = \"\")\n\nzips_table <- data.frame(zips_table[,1:2], county_zips)\ncolnames(zips_table) <- c(\"zip\", \"state\", \"county\")\nzips_table <- zips_table[order(zips_table$state),]\n\n#Now convert state abbreviations to actual state names\nzips_table <- merge(zips_table, us_states, by = \"state\")\nzips_table <- zips_table[,2:4]\ncolnames(zips_table) <- c(\"zip\", \"county\", \"state\")\n\n\n\n\n##########Get 12th grader demographics by county from (2009-2013)#############\n# High_Schoolers_by_county_Race_data Notes                                   #\n# DOwnloaded using US Census Data Ferret Interface                           #\n# All values are for number of students enrolled in grade 12                 #\n#                                                                            #        \n#                                                                            # \n# Col 1 = County\n# Col 2  = State\n# COl 3  = B14007I_016E -- Hispanic or Latino                                 #\n# COl 4  = B14007H_016E -- WHite Alone, Not HIspanic                          #\n# Col 5 = B14007B_016E - Black or Arfican American Alone                     #\n# COl 6 = B14007C_016E- American Indian and Alaska Native ALONE              #\n# Col 7 = B14007D_016E -- Asian ALone                                        #\n# Col 8 = B14007E_016E -- Native Hawaiian and Other Pacific IslanderAlone    #\n#                                                                            #\n#                                                                            #\n# DATA SET - American Community Survey, 2009-2013, 5 Year Summary File       #\n#                                                                            #\n# Accessed 4/11/2015 @ 9:14pm                                                #\n##############################################################################\n\n# #High Schooler Demographic Data\nRace_zip_raw <- read.csv(\"High_Schoolers_by_county_Race_data.csv\")\ncolnames(Race_zip_raw) <- c(\"county\",\"state\", \"hispanic\", \"white\", \"black\", \"native\", \"asian\", \"hawaiianPI\")\n#Values in total table aggregate Asian and Pacific Islander students, need to do\n#the same here\nasianPI <- Race_zip_raw$asian + Race_zip_raw$hawaiianPI\n#Race zip has the counties listed as \"Name County\", need to clean this up for direct comparison\ncounty <- gsub(x = Race_zip_raw$county, pattern = \" County\", replace = \"\")\nRace_zip <- data.frame(county, Race_zip_raw[, 2:6], asianPI)\nRace_zip <- Race_zip[order(Race_zip$state),]\ncolnames(Race_zip) <- c(\"county\", \"state\", \"county_12th_hispanic\", \"county_12th_white\", \"county_12th_black\", \"county_12th_native\", \"county_12th_asianPI\")\n\n# #At this point:\n#  -- zips_table has the zip code, the county and the state\n#  -- Race_zip has the county, state, and number of 12th graders by race\n#  -- Degree_School_Table has the zip code, city and state\n\n#Add the county value to total\n\nDegree_School_Table <- merge(Degree_School_Table, zips_table, by = \"zip\")\n#####################names(intermediate_table)##########################################\n# [1] \"zip\"                    \"school\"                 \"city\"                  #\n# [4] \"state.x\"                \"total STEM degrees\"     \"total degrees Black\"   #\n# [7] \"total degrees Native\"   \"total degrees AsianPI\"  \"total degrees Hispanic\"#\n# [10] \"total degrees White\"    \"county\"                 \"state.y\"              #\n#################################################################################\n\nDegree_School_Table <- data.frame(Degree_School_Table[,2], Degree_School_Table[,1],Degree_School_Table[, 4], Degree_School_Table[,11], Degree_School_Table[, 5:10])\ncolnames(Degree_School_Table) <- c(\"school\", \"zip\", \"state\", \"county\", \"total_STEM_degrees\", \"total degrees Black\", \"total degrees Native\", \"total degrees AsianPI\", \"total degrees Hispanic\", \"total degrees White\")\n\n#Create id to correlate the Degree_School_Table and the Race_zip tables\nDegree_School_Table <- within(Degree_School_Table, id <- paste(county, state, sep = \", \"))\nRace_zip <- within(Race_zip, id <- paste(county, state, sep = \",\"))\nRace_zip$total <- rowSums(Race_zip[,3:7])\n\n#Sort table of schools by total number of STEM degrees for all races, descending\nDegree_School_Table <- Degree_School_Table[order(-Degree_School_Table[,5]),]\nwrite.csv(file = \"./Final_Degree_University_Table.csv\", x = Degree_School_Table)\nwrite.csv(file = \"./Final_Race_zip_table.csv\", x = Race_zip)\n\n\n#Select the top ten STEM bachelors granting schools in the US\ntop_ten <- Degree_School_Table[1:10,]\ntop_ten_ids <- Degree_School_Table$id[1:10]\n\n#Use ID values to get the demographics of 12th graders in the counties the schools\n#are located and sort them in the same order as the top_ten STEM granting schools\ntop_ten_12th <- with(Race_zip, Race_zip[id %in% top_ten_ids,])\ntop_ten_12th <- top_ten_12th[order(match(top_ten_12th$id, top_ten$id)),]\n#Do a quick bar chart of the breakdown of degrees granted by race\n\n#total_for_plot <- data.frame(Black = total[,5], Native = total[,6], AsianPI = total[,7], Hispanic = total[,8], White = total[,9])\nDegree_school_plot <- data.frame(Black = top_ten[,6]/top_ten[,5], Native = top_ten[,7]/top_ten[,5], AsianPI = top_ten[,8]/top_ten[,5], Hispanic = top_ten[,9]/top_ten[,5], White = top_ten[,10]/top_ten[,5])\nschool_plot_12th <- data.frame(top_ten_12th[,5]/top_ten_12th[,9], top_ten_12th[,6]/top_ten_12th[,9], top_ten_12th[,7]/top_ten_12th[,9], top_ten_12th[,3]/top_ten_12th[,9], top_ten_12th[,4]/top_ten_12th[,9])\ncolnames(school_plot_12th) <- c(\"12th Black\", \"12th Native\",\"12th AsianPI\", \"12th Hispanic\", \"12th White\" )\nnames <- top_ten[1:10,1]\nrownames(Degree_school_plot)<- names\nrownames(school_plot_12th) <- names\nxmax <- signif(max(top_ten[,5]),1)\n\ntitle = c(\"Number of STEM Bachelor's Degrees Granted, by Race, \\nfor Top 10 STEM Degree Granting Schools (2009 - 2013)\")\ntitleB = c(\"Number of 12th Graders enrolled within the same county\\n as Top 10 STEM Degree Granting Schools (2009-2013) \")\nmymat <- as.matrix(Degree_school_plot)\nmymatB <- as.matrix(school_plot_12th)\nmymat_t <- t(mymat)\nmymatB_t <- t(mymatB)\npar(mar = c(5, 20, 2, 5))\nplot_colors <- c(\"darkblue\", \"gold1\", \"indianred3\", \"chartreuse\", \"slateblue\")\ntitle(title, line = -20)\nlegend_list <- list(x = 1.2, y = 15, bty = \"n\")\nbarplot(mymat_t, xlim = c(0, 1), main = title, adj = 0, horiz = TRUE, names.arg = names, las = 1, col = plot_colors, legend = names(Degree_school_plot))\n\nbarplot(mymatB_t, xlim = c(0, 1), main = titleB, adj = 0, horiz = TRUE, names.arg = names, las = 1, col = plot_colors, legend = names(school_plot_12th), args.legend = legend_list)\n\n\n",
    "created" : 1428600300848.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3227214641",
    "id" : "B4221944",
    "lastKnownWriteTime" : 1428963489,
    "path" : "~/data scientist class/Data Incubator/Degree DataBase/Degree_Data.R",
    "project_path" : "Degree_Data.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}